!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)}([function(e,t,i){},function(e,t,i){},function(e,t,i){"use strict";i.r(t);var n={1:10,2:25,3:75,4:100},o=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,0],[2,2,2],[0,0,2]],[[0,0,0],[3,3,3],[3,0,0]],[[0,0,0,0],[0,4,4,0],[0,4,4,0],[0,0,0,0]],[[0,0,0],[0,5,5],[5,5,0]],[[0,0,0],[6,6,6],[0,6,0]],[[0,0,0],[7,7,0],[0,7,7]]],s=39,r=37,a=38,h=40,l=82,c=80,u=32,d={1:"#ffc90d",2:"#ff7f26",3:"#eb2325",4:"#23b14d",5:"#3f46cb",6:"#a349a3",7:"#01a2e8"};function f(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.reset()}var t,i,s;return t=e,(i=[{key:"getState",value:function(){for(var e=this.createPlayfield(),t=this.activePiece,i=t.y,n=t.x,o=t.blocks,s=0;s<this.playfield.length;s++){e[s]=[];for(var r=0;r<this.playfield[s].length;r++)e[s][r]=this.playfield[s][r]}for(var a=0;a<o.length;a++)for(var h=0;h<o[a].length;h++)o[a][h]&&(e[i+a][n+h]=o[a][h]);return{playfield:e,level:this.level,lines:this.lines,nextPiece:this.nextPiece,score:this.score,isGameOver:this.topOut,highScore:this.highScore}}},{key:"reset",value:function(){this.score=0,this.lines=0,this.topOut=!1,this.highScore=this.getHighScore(),this.playfield=this.createPlayfield(),this.activePiece=this.createPiece(),this.nextPiece=this.createPiece()}},{key:"createPlayfield",value:function(){for(var e=[],t=0;t<20;t++){e[t]=[];for(var i=0;i<10;i++)e[t][i]=0}return e}},{key:"createPiece",value:function(){var e={},t=Math.floor(Math.random()*o.length);return e.blocks=o[t].map((function(e){return e.slice()})),e.x=Math.floor((10-e.blocks[0].length)/2),e.y=-1,e}},{key:"dropDown",value:function(){if(!this.topOut){for(;;)if(this.activePiece.y+=1,this.hasCollision()){this.activePiece.y-=1,this.lockPiece(),this.clearLines(),this.updatePieces();break}this.checkCollision()}}},{key:"movePieceLeft",value:function(){this.activePiece.x-=1,this.hasCollision()&&(this.activePiece.x+=1)}},{key:"movePieceRight",value:function(){this.activePiece.x+=1,this.hasCollision()&&(this.activePiece.x-=1)}},{key:"movePieceDown",value:function(){this.topOut||(this.activePiece.y+=1,this.hasCollision()&&(this.activePiece.y-=1,this.lockPiece(),this.clearLines(),this.updatePieces()),this.checkCollision())}},{key:"checkCollision",value:function(){this.hasCollision()&&(this.topOut=!0,this.score>this.highScore&&this.setHighScore(this.score))}},{key:"rotatePiece",value:function(){this.rotateBlocks(),this.hasCollision()&&this.rotateBlocks(!1)}},{key:"rotateBlocks",value:function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.activePiece.blocks,i=t.length,n=Math.floor(i/2),o=i-1,s=0;s<n;s++)for(var r=s;r<o-s;r++){var a=t[s][r];e?(t[s][r]=t[o-r][s],t[o-r][s]=t[o-s][o-r],t[o-s][o-r]=t[r][o-s],t[r][o-s]=a):(t[s][r]=t[r][o-s],t[r][o-s]=t[o-s][o-r],t[o-s][o-r]=t[o-r][s],t[o-r][s]=a)}}},{key:"hasCollision",value:function(){for(var e=this.playfield,t=this.activePiece,i=t.blocks,n=t.y,o=t.x,s=0;s<i.length;s++)for(var r=0;r<i[s].length;r++)if(i[s][r]&&(void 0===e[n+s]||void 0===e[n+s][o+r]||e[n+s][o+r]))return!0;return!1}},{key:"lockPiece",value:function(){for(var e=this.activePiece,t=e.blocks,i=e.y,n=e.x,o=0;o<t.length;o++)for(var s=0;s<t[o].length;s++)t[o][s]&&(this.playfield[i+o][n+s]=t[o][s])}},{key:"clearLines",value:function(){for(var e=[],t=19;t>=0;t--){for(var i=0,n=0;n<10;n++)this.playfield[t][n]&&(i+=1);if(0===i)break;i<10||10===i&&e.unshift(t)}for(var o=0,s=e;o<s.length;o++){var r=s[o];this.playfield.splice(r,1),this.playfield.unshift(new Array(10).fill(0))}this.updateScore(e.length)}},{key:"updateScore",value:function(e){e>0&&(this.score+=n[e]*(this.level+1),this.lines+=e)}},{key:"updatePieces",value:function(){this.activePiece=this.nextPiece,this.nextPiece=this.createPiece()}},{key:"getHighScore",value:function(){var e=localStorage.getItem("highScore");return/^\d+$/.test(e)?Number(e):0}},{key:"setHighScore",value:function(e){localStorage.setItem("highScore",e)}},{key:"level",get:function(){return Math.floor(.1*this.lines)}}])&&f(t.prototype,i),s&&f(t,s),e}();function y(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=500,this.canvas.height=640,this.playfieldBorderWidth=4,this.playfieldWidth=Math.floor(320),this.playfieldHeight=640,this.playfieldInnerWidth=this.playfieldWidth,this.playfieldInnerHeight=this.playfieldHeight,this.blockWidth=Math.floor(this.playfieldInnerWidth/10),this.blockHeight=Math.floor(this.playfieldInnerHeight/20),this.panelX=this.playfieldWidth+10,this.panelY=0,this.panelWidth=Math.floor(180),this.panelHeight=640,this.element.appendChild(this.canvas)}var t,i,n;return t=e,(i=[{key:"renderMainScreen",value:function(e){this.clearScreen(),this.renderPlayfield(e),this.renderPanel(e)}},{key:"clearScreen",value:function(){this.context.clearRect(0,0,500,640)}},{key:"renderStartScreen",value:function(){this.renderText("white","18px","center","middle",'Press "R" to Start',250,320)}},{key:"renderPauseScreen",value:function(){this.context.fillStyle="rgba(0, 0, 0, 0.75)",this.context.fillRect(0,0,500,640),this.renderText("white","18px","center","middle",'Press "P" to Resume',250,320)}},{key:"renderEndScreen",value:function(e){var t=e.score;this.clearScreen(),this.renderText("white","18px","center","middle","GAME OVER",250,272),this.renderText("white","18px","center","middle","Score: ".concat(t),250,320),this.renderText("white","18px","center","middle",'Press "R" to Restart',250,368)}},{key:"renderText",value:function(e,t,i,n,o,s,r){this.context.fillStyle=e,this.context.font="".concat(t," 'Press Start 2P'"),this.context.textAlign=i,this.context.textBaseline=n,this.context.fillText(o,s,r)}},{key:"renderPlayfield",value:function(e){for(var t=e.playfield,i=0;i<t.length;i++){this.drawGrid(i);for(var n=0;n<t[i].length;n++){var o=t[i][n];o&&this.roundRect(n*this.blockWidth,i*this.blockHeight,this.blockWidth,this.blockHeight,d[o])}}this.context.beginPath(),this.context.moveTo(this.playfieldInnerWidth+this.playfieldBorderWidth,0),this.context.lineTo(this.playfieldInnerWidth+this.playfieldBorderWidth,this.playfieldInnerHeight),this.context.strokeStyle="#696f75",this.context.lineWidth=this.playfieldBorderWidth,this.context.stroke(),this.context.closePath()}},{key:"drawGrid",value:function(e){this.context.beginPath(),this.context.moveTo(0,e*this.blockWidth),this.context.lineTo(this.playfieldInnerWidth+this.playfieldBorderWidth,e*this.blockWidth),e<10&&(this.context.moveTo(e*this.blockWidth,0),this.context.lineTo(e*this.blockWidth,this.playfieldInnerHeight)),this.context.strokeStyle="#696f75",this.context.lineWidth=.35,this.context.stroke(),this.context.closePath()}},{key:"renderPanel",value:function(e){var t=e.level,i=e.score,n=e.lines,o=e.nextPiece,s=e.highScore;this.renderText("white","14px","start","top","Score: ".concat(i),this.panelX,this.panelY+8),this.renderText("white","14px","start","top","Level: ".concat(t),this.panelX,this.panelY+32),this.renderText("white","14px","start","top","Lines: ".concat(n),this.panelX,this.panelY+56),this.renderText("white","14px","start","top","Next:",this.panelX,this.panelY+104),this.renderText("white","14px","start","top","HI: ".concat(s),this.panelX,this.panelHeight-20);for(var r=0;r<o.blocks.length;r++)for(var a=0;a<o.blocks[r].length;a++){var h=o.blocks[r][a];h&&this.roundRect(this.panelX+a*this.blockWidth*.65,this.panelY+105+r*this.blockHeight*.65,.65*this.blockWidth,.65*this.blockHeight,d[h])}}},{key:"roundRect",value:function(e,t,i,n,o){var s=5,r=5,a=5,h=5;this.context.beginPath(),this.context.fillStyle=o,this.context.lineWidth=2,this.context.strokeStyle="#f9fafb",this.context.moveTo(e+s,t),this.context.lineTo(e+i-r,t),this.context.quadraticCurveTo(e+i,t,e+i,t+r),this.context.lineTo(e+i,t+n-a),this.context.quadraticCurveTo(e+i,t+n,e+i-a,t+n),this.context.lineTo(e+h,t+n),this.context.quadraticCurveTo(e,t+n,e,t+n-h),this.context.lineTo(e,t+s),this.context.quadraticCurveTo(e,t,e+s,t),this.context.closePath(),this.context.fill(),this.context.stroke()}}])&&y(t.prototype,i),n&&y(t,n),e}();function g(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var m=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.game=t,this.view=i,this.intervalId=null,this.isPlaying=!1,this.moveInterval=null,this.isMouseDownEvent=!1,this.isTouchStartEvent=!1,this.addEventListeners(),this.view.renderStartScreen()}var t,i,n;return t=e,(i=[{key:"addEventListeners",value:function(){window.addEventListener("blur",this.pause.bind(this)),document.addEventListener("keyup",this.handleKeyUp.bind(this)),document.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("contextmenu",(function(e){e.preventDefault&&e.preventDefault()})),document.addEventListener("touchstart",(function(e){e.preventDefault&&e.preventDefault()}),!0),document.addEventListener("touchend",(function(e){e.preventDefault&&e.preventDefault()}),!0),document.addEventListener("gesturestart",(function(e){e.preventDefault&&event.preventDefault()})),document.addEventListener("mousedown",(function(e){e.preventDefault&&e.preventDefault()}),!0),this.onMouseDown(document.querySelector(".left-button"),this.startMoveLeft.bind(this)),this.onMouseUp(document.querySelector(".left-button"),this.stopMove.bind(this)),this.onMouseDown(document.querySelector(".right-button"),this.startMoveRight.bind(this)),this.onMouseUp(document.querySelector(".right-button"),this.stopMove.bind(this)),this.onMouseDown(document.querySelector(".pause-button"),this.togglePlayPause.bind(this)),this.onMouseDown(document.querySelector(".reset-button"),this.reset.bind(this)),this.onMouseDown(document.querySelector(".rotation-button"),this.startRotation.bind(this)),this.onMouseUp(document.querySelector(".rotation-button"),this.stopMove.bind(this)),this.onMouseDown(document.querySelector(".down-button"),this.startMoveDown.bind(this)),this.onMouseUp(document.querySelector(".down-button"),this.endMoveDown.bind(this)),this.onMouseDown(document.querySelector(".drop-button"),this.startDrop.bind(this))}},{key:"onMouseDown",value:function(e,t){var i=this;e.addEventListener("mousedown",(function(){i.isTouchStartEvent?i.isTouchStartEvent=!1:(t(),i.isMouseDownEvent=!0)}),!0),e.addEventListener("touchstart",(function(){i.isTouchStartEvent=!0,t()}),!0)}},{key:"onMouseUp",value:function(e,t){var i=this;e.addEventListener("mouseup",(function(){i.isTouchStartEvent?i.isTouchStartEvent=!1:(t(),i.isMouseDownEvent=!0)}),!0),e.addEventListener("touchend",t,!0)}},{key:"update",value:function(){this.game.movePieceDown(),this.updateView()}},{key:"play",value:function(){this.isPlaying=!0,this.startTimer(),this.updateView()}},{key:"pause",value:function(){"number"==typeof this.intervalId&&(this.isPlaying=!1,this.stopMove(),this.stopTimer(),this.updateView())}},{key:"reset",value:function(){this.stopTimer(),this.game.reset(),this.play()}},{key:"startTimer",value:function(){if(!this.intervalId){var e=800-100*this.game.getState().level,t=e>=200?e:200;this.intervalId=setInterval(this.update.bind(this),t)}}},{key:"stopTimer",value:function(){"number"==typeof this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}},{key:"updateView",value:function(){var e=this.game.getState();e.isGameOver?this.view.renderEndScreen(e):this.isPlaying?this.view.renderMainScreen(e):this.view.renderPauseScreen()}},{key:"onLeft",value:function(){this.isPlaying&&(this.game.movePieceLeft(),this.updateView())}},{key:"startMoveLeft",value:function(){this.startMove(this.onLeft.bind(this))}},{key:"onRight",value:function(){this.isPlaying&&(this.game.movePieceRight(),this.updateView())}},{key:"startMoveRight",value:function(){this.startMove(this.onRight.bind(this))}},{key:"onUp",value:function(){this.isPlaying&&(this.game.rotatePiece(),this.updateView())}},{key:"startRotation",value:function(){this.startMove(this.onUp.bind(this))}},{key:"startMove",value:function(e){e(),this.moveInterval=setInterval(e,150)}},{key:"onDown",value:function(){this.isPlaying&&(this.stopTimer(),this.game.movePieceDown(),this.updateView())}},{key:"startMoveDown",value:function(){this.startMove(this.onDown.bind(this))}},{key:"endMoveDown",value:function(){this.isPlaying&&this.startTimer(),this.stopMove()}},{key:"startDrop",value:function(){this.isPlaying&&(this.game.dropDown(),this.updateView())}},{key:"stopMove",value:function(){clearInterval(this.moveInterval)}},{key:"togglePlayPause",value:function(){this.isPlaying?this.pause():this.play()}},{key:"handleKeyDown",value:function(e){var t=e.keyCode;t===l?this.reset():t===c?this.togglePlayPause():t===r?this.onLeft():t===a?this.onUp():t===s?this.onRight():t===h?this.onDown():t===u&&this.startDrop()}},{key:"handleKeyUp",value:function(e){e.keyCode===h&&this.endMoveDown()}}])&&g(t.prototype,i),n&&g(t,n),e}();i(0),i(1);window.addEventListener("load",(function(){var e=document.getElementById("root"),t=document.querySelector(".game-screen"),i=document.querySelector(".game-controls"),n=new v,o=new p(t);new m(n,o);var s,r=(s=document.body,["transform","webkitTransform","msTransform","mozTransform","oTransform"].filter((function(e){return void 0!==s.style[e]}))[0]),a=function(){var t,n=document.documentElement.clientWidth,o=document.documentElement.clientHeight;if(o/n<1.5)e.style.paddingTop="42px",i.style.marginTop="25px",t=o/960;else{var s=(o-960*(t=n/640))/t/3;i.style.marginTop="".concat(s+25,"px"),e.style.paddingTop="".concat(Math.floor(s)+42,"px"),e.style.paddingBottom="".concat(Math.floor(s),"px"),e.style.marginTop="".concat(Math.floor(-480-1.5*s),"px")}e.style[r]="scale(".concat(t,")")};a(),window.addEventListener("resize",a)}))}]);